@model EmsWebApp.Models.EmployeeProfileViewModel

@{
    ViewData["Title"] = "Home Page";
}
<h2>Employee Profiles</h2>
<table class="table">
  <thead>
    <tr>
      <th scope="col">Employee ID</th>
      <th scope="col">Full Name</th>
      <th scope="col">Title</th>
      <th scope="col">From Date</th>
      <th scope="col">To Date</th>
      <th scope="col">Salary</th>
    </tr>
  </thead>
  <tbody>
  @foreach (EmployeeProfile item in Model.Items) {
    <tr>
      <th scope="row">@item.EmployeeId</th>
      <td>@item.EmployeeName</td>
      <td>@item.Title</td>      
      <td>@item.FromDate.ToString("yyyy-MM-dd")</td>
      <td>@(item.ToDate.HasValue ? item.ToDate.Value.ToString("yyyy-MM-dd") : "Present")</td>
      <td>@item.Salary.ToString("C")</td>
    </tr>
  }
  </tbody>
</table>

@section Scripts {
    <script type="text/javascript">
        $(document).ready(function () {
            $('.table').DataTable({
                order: [[1, 'asc']],
                rowGroup: {
                    dataSrc: 1,
                    startRender: null,
                    endRender: function (rows, group) {
                        var avg = rows
                                .data()
                                .pluck(5)
                                .reduce((a, b) => a + b.replace(/[^\d]/g, '') * 1, 0) / rows.count();
            
                        // Use the DataTables number formatter
                        return (
                            'Avg Salary of ' + group + ' : ' +
                            DataTable.render.number(null, null, 0, '$').display(avg)
                        );
                    }
                },
            });
        });
    </script>
}
